<!DOCTYPE html>

<html>
<head>
  <title>fs.go</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>fs.go</h1>
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="cli.html">
                    cli.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="become.html">
                    become.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="cache.html">
                    cache.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="copy.html">
                    copy.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="dep_graph.html">
                    dep_graph.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="elasticache.html">
                    elasticache.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="elb.html">
                    elb.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="file.html">
                    file.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="git.html">
                    git.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="iam.html">
                    iam.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="instance.html">
                    instance.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="keypairs.html">
                    keypairs.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="log.html">
                    log.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="mithras.html">
                    mithras.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="moment.html">
                    moment.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="network.html">
                    network.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="object_path.html">
                    object_path.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="packager.html">
                    packager.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="rds.html">
                    rds.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="route53.html">
                    route53.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="s3.html">
                    s3.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="scp.html">
                    scp.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="secgroup.html">
                    secgroup.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="service.html">
                    service.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="shell.html">
                    shell.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="sprintf.html">
                    sprintf.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="subnet.html">
                    subnet.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="traverse.html">
                    traverse.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="vpc.html">
                    vpc.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="main.html">
                    main.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="build.html">
                    build.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="channels.html">
                    channels.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="core.html">
                    core.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="elasticache.html">
                    elasticache.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="elb.html">
                    elb.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="exec.html">
                    exec.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="filepath.html">
                    filepath.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="fs.html">
                    fs.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="goroutines.html">
                    goroutines.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="iam.html">
                    iam.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="instance.html">
                    instance.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="keypairs.html">
                    keypairs.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="log.html">
                    log.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="network.html">
                    network.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="os.html">
                    os.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="peek.html">
                    peek.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="rds.html">
                    rds.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="region.html">
                    region.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="remote.html">
                    remote.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="require.html">
                    require.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="route53.html">
                    route53.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="routetables.html">
                    routetables.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="s3.html">
                    s3.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="secgroup.html">
                    secgroup.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="service.html">
                    service.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="subnet.html">
                    subnet.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="tag.html">
                    tag.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="time.html">
                    time.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="user.html">
                    user.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="vpc.html">
                    vpc.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="web.html">
                    web.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="wrapper.html">
                    wrapper.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="script.html">
                    script.go
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        <p>MITHRAS: Javascript configuration management tool for AWS.
Copyright (C) 2016, Colin Steele</p>
<p> This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
                 (at your option) any later version.</p>
<p>   This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
             GNU General Public License for more details.</p>
<p>  You should have received a copy of the GNU General Public License
along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>

        
      
        
        <h1 id="core-functions-fs">CORE FUNCTIONS: FS</h1>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">package</span> fs</pre></div>
        
      
        
        <p>This package exports entry points into the JS environment:</p>
<blockquote>
<ul>
<li><a href="#chtimes">fs.chtimes</a></li>
<li><a href="#link">fs.link</a></li>
<li><a href="#symlink">fs.symlink</a></li>
<li><a href="#create">fs.create</a></li>
<li><a href="#close">fs.close</a></li>
<li><a href="#read">fs.read</a></li>
<li><a href="#write">fs.write</a></li>
<li><a href="#copy">fs.copy</a></li>
<li><a href="#chdir">fs.chdir</a></li>
<li><a href="#getwd">fs.getwd</a></li>
<li><a href="#mkdirAll">fs.mkdirAll</a></li>
<li><a href="#remove">fs.remove</a></li>
<li><a href="#removeAll">fs.removeAll</a></li>
<li><a href="#rename">fs.rename</a></li>
<li><a href="#chown">fs.chown</a></li>
<li><a href="#lchown">fs.lChown</a></li>
<li><a href="#chmod">fs.chmod</a></li>
<li><a href="#dir">fs.dir</a></li>
<li><a href="#stat">fs.stat</a></li>
</ul>
</blockquote>
<p>This API allows the caller to work with files.</p>
<h2 id="fs-chtimes">FS.CHTIMES</h2>
<p><a name="chtimes"></a>
<code>filepath.chtimes(path);</code></p>
<p>Sets the file at <code>path</code> to have current atime and mtime.  TODO: rename this to <code>touch</code>.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> err = fs.chtimes(<span class="hljs-string">"/tmp/foo"</span>);
</code></pre><h2 id="fs-link">FS.LINK</h2>
<p><a name="link"></a>
<code>filepath.link(old, new);</code></p>
<p>Link creates newname as a hard link to the oldname file. If there
is an error, it will be of type LinkError.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> err = fs.link(<span class="hljs-string">"/tmp/old"</span> <span class="hljs-string">"/tmp/new"</span>);
</code></pre><h2 id="fs-symlink">FS.SYMLINK</h2>
<p><a name="symlink"></a>
<code>filepath.symlink(old, new);</code></p>
<p>Symlink creates newname as a symbolic link to oldname. If there is
an error, it will be of type LinkError.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> err = fs.symlink(<span class="hljs-string">"/tmp/old"</span> <span class="hljs-string">"/tmp/new"</span>);
</code></pre><h2 id="fs-create">FS.CREATE</h2>
<p><a name="create"></a>
<code>filepath.create(path);</code></p>
<p>Create creates the named file with mode 0666 (before umask),
truncating it if it already exists. If successful, methods on the
returned File can be used for I/O; the associated file descriptor
has mode O_RDWR. If there is an error, it will be of type
PathError.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = fs.create(<span class="hljs-string">"/tmp/foo"</span>);
 <span class="hljs-keyword">var</span> file = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> error = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="fs-close">FS.CLOSE</h2>
<p><a name="close"></a>
<code>filepath.close(file);</code></p>
<p>Close closes the File, rendering it unusable for I/O. It returns an
error, if any.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = fs.create(<span class="hljs-string">"/tmp/foo"</span>);
 <span class="hljs-keyword">var</span> file = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> error = results[<span class="hljs-number">1</span>];
 <span class="hljs-keyword">if</span> (error) {
  ...
 }
 <span class="hljs-keyword">var</span> error = fs.<span class="hljs-built_in">close</span>(file);
</code></pre><h2 id="fs-read">FS.READ</h2>
<p><a name="read"></a>
<code>filepath.read(path);</code></p>
<p>Read the contents of the file at <code>path</code>.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = fs.read(<span class="hljs-string">"/tmp/foo"</span>);
 <span class="hljs-keyword">var</span> contents = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> error = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="fs-write">FS.WRITE</h2>
<p><a name="write"></a>
<code>filepath.write(path, contents, perms);</code></p>
<p>Write the contents of the file at <code>path</code>.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.read(<span class="hljs-string">"/tmp/foo"</span>, <span class="hljs-string">"contents"</span>, <span class="hljs-number">0644</span>);
</code></pre><h2 id="fs-copy">FS.COPY</h2>
<p><a name="copy"></a>
<code>filepath.copy(src, dest, perms);</code></p>
<p>Copy the file from <code>src</code> to <code>dest</code>.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.<span class="hljs-built_in">copy</span>(<span class="hljs-string">"/tmp/foo"</span>, <span class="hljs-string">"/tmp/bar"</span>, <span class="hljs-number">0644</span>);
</code></pre><h2 id="fs-chdir">FS.CHDIR</h2>
<p><a name="chdir"></a>
<code>filepath.chdir(dir);</code></p>
<p>Change working director to <code>dir</code>.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.chdir(<span class="hljs-string">"/tmp"</span>);
</code></pre><h2 id="fs-getwd">FS.GETWD</h2>
<p><a name="getwd"></a>
<code>filepath.getwd();</code></p>
<p>Get the current working directory.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = fs.getwd();
 <span class="hljs-keyword">var</span> where = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> err = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="fs-mkdirall">FS.MKDIRALL</h2>
<p><a name="mkdirAll"></a>
<code>filepath.mkdirALL(path, perm);</code></p>
<p>MkdirAll creates a directory named path, along with any necessary
parents, and returns nil, or else returns an error. The permission
bits perm are used for all directories that MkdirAll creates. If
path is already a directory, MkdirAll does nothing and returns nil.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.mkdirAll(<span class="hljs-string">"/tmp/a/b/c"</span>, <span class="hljs-number">0777</span>);
</code></pre><h2 id="fs-remove">FS.REMOVE</h2>
<p><a name="remove"></a>
<code>filepath.remove(path);</code></p>
<p>Remove the file at <code>path</code>.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.remove(<span class="hljs-string">"/tmp/a/b/c"</span>);
</code></pre><h2 id="fs-removeall">FS.REMOVEALL</h2>
<p><a name="removeAll"></a>
<code>filepath.removeAll(path);</code></p>
<p>RemoveAll removes path and any children it contains. It removes
everything it can but returns the first error it encounters. If the
path does not exist,</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.removeAll(<span class="hljs-string">"/tmp/a/b/c"</span>);
</code></pre><h2 id="fs-rename">FS.RENAME</h2>
<p><a name="rename"></a>
<code>filepath.rename(oldname, newname);</code></p>
<p>Rename renames (moves) oldpath to newpath. If newpath already
exists, Rename replaces it. OS-specific restrictions may apply when
oldpath and newpath are in different directories. If there is an
error, it will be of type *LinkError.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.rename(<span class="hljs-string">"/tmp/foo"</span>, <span class="hljs-string">"/tmp/bar"</span>);
</code></pre><h2 id="fs-chown">FS.CHOWN</h2>
<p><a name="chown"></a>
<code>filepath.chown(path, uid, gid);</code></p>
<p>Chown changes the numeric uid and gid of the named file. If the
file is a symbolic link,it changes the uid and gid of the link’s
target. If there is an error, it will be of type *PathError.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.chown(<span class="hljs-string">"/tmp/foo"</span>, <span class="hljs-number">12</span>, <span class="hljs-number">34</span>);
</code></pre><h2 id="fs-lchown">FS.LCHOWN</h2>
<p><a name="lchown"></a>
<code>filepath.lChown(path, uid, gid);</code></p>
<p>Lchown changes the numeric uid and gid of the named file. If the
file is a symbolic link, it changes the uid and gid of the link
itself. If there is an error, it will be of type *PathError.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.lchown(<span class="hljs-string">"/tmp/foo"</span>, <span class="hljs-number">12</span>, <span class="hljs-number">34</span>);
</code></pre><h2 id="fs-chmod">FS.CHMOD</h2>
<p><a name="chmod"></a>
<code>filepath.chmod(path, mode);</code></p>
<p>Chmod changes the mode of the named file to mode. If the file is a
symbolic link, it changes the mode of the link’s target. If there
is an error, it will be of type *PathError.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> error = fs.chmod(<span class="hljs-string">"/tmp/foo"</span>, <span class="hljs-number">0777</span>);
</code></pre><h2 id="fs-dir">FS.DIR</h2>
<p><a name="dir"></a>
<code>filepath.dir(path);</code></p>
<p>Return the directory entries from <code>path</code></p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = fs.chmod(<span class="hljs-string">"/tmp"</span>);
 <span class="hljs-keyword">var</span> entries = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> error = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="fs-stat">FS.STAT</h2>
<p><a name="stat"></a>
<code>filepath.stat(path);</code></p>
<p>Stat returns the FileInfo structure describing file. If there is an
error, it will be of type *PathError.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = fs.stat(<span class="hljs-string">"/tmp/foo"</span>);
 <span class="hljs-keyword">var</span> info = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> error = results[<span class="hljs-number">1</span>];
</code></pre>
        
          <div class='highlight'><pre><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"io"</span>
	<span class="hljs-string">"io/ioutil"</span>
	<span class="hljs-string">"log"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"time"</span>

	<span class="hljs-string">"github.com/robertkrimen/otto"</span>

	mcore <span class="hljs-string">"github.com/cvillecsteele/mithras/modules/core"</span>
)

<span class="hljs-keyword">var</span> Version = <span class="hljs-string">"1.0.0"</span>
<span class="hljs-keyword">var</span> ModuleName = <span class="hljs-string">"fs"</span>

<span class="hljs-keyword">func</span> dir(src <span class="hljs-keyword">string</span>) (names []<span class="hljs-keyword">string</span>, err error) {
	f, err := os.Open(src)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> []<span class="hljs-keyword">string</span>{}, err
	}
	<span class="hljs-keyword">defer</span> f.Close()
	<span class="hljs-keyword">return</span> f.Readdirnames(<span class="hljs-number">0</span>)
}

<span class="hljs-keyword">func</span> read(fileName <span class="hljs-keyword">string</span>) (<span class="hljs-keyword">string</span>, error) {
	content, err := ioutil.ReadFile(fileName)
	<span class="hljs-keyword">return</span> <span class="hljs-keyword">string</span>(content), err
}

<span class="hljs-keyword">func</span> write(fileName, data <span class="hljs-keyword">string</span>, perm <span class="hljs-keyword">uint64</span>) error {
	<span class="hljs-keyword">return</span> ioutil.WriteFile(fileName, []<span class="hljs-keyword">byte</span>(data), os.FileMode(perm))
}

<span class="hljs-keyword">func</span> <span class="hljs-built_in">copy</span>(src, dst <span class="hljs-keyword">string</span>, perm <span class="hljs-keyword">uint64</span>) error {
	s, err := os.Open(src)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}</pre></div>
        
      
        
        <p>no need to check errors on read only file, we already got everything
we need from the filesystem, so nothing can go wrong now.</p>

        
          <div class='highlight'><pre>	<span class="hljs-keyword">defer</span> s.Close()
	d, err := os.Create(dst)
	<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}
	<span class="hljs-keyword">if</span> _, err := io.Copy(d, s); err != <span class="hljs-literal">nil</span> {
		d.Close()
		<span class="hljs-keyword">return</span> err
	}
	<span class="hljs-keyword">if</span> err = d.Close(); err != <span class="hljs-literal">nil</span> {
		<span class="hljs-keyword">return</span> err
	}

	<span class="hljs-keyword">return</span> os.Chmod(dst, os.FileMode(perm))
}

<span class="hljs-keyword">func</span> chdir(dir <span class="hljs-keyword">string</span>) error {
	<span class="hljs-keyword">return</span> os.Chdir(dir)
}

<span class="hljs-keyword">func</span> getwd() (<span class="hljs-keyword">string</span>, error) {
	<span class="hljs-keyword">return</span> os.Getwd()
}

<span class="hljs-keyword">func</span> mkdir(dir <span class="hljs-keyword">string</span>, perm <span class="hljs-keyword">uint64</span>) error {
	<span class="hljs-keyword">return</span> os.Mkdir(dir, os.FileMode(perm))
}

<span class="hljs-keyword">func</span> mkdirAll(path <span class="hljs-keyword">string</span>, perm <span class="hljs-keyword">uint64</span>) error {
	<span class="hljs-keyword">return</span> os.MkdirAll(path, os.FileMode(perm))
}

<span class="hljs-keyword">func</span> remove(name <span class="hljs-keyword">string</span>) error {
	<span class="hljs-keyword">return</span> os.Remove(name)
}

<span class="hljs-keyword">func</span> removeAll(name <span class="hljs-keyword">string</span>) error {
	<span class="hljs-keyword">return</span> os.RemoveAll(name)
}

<span class="hljs-keyword">func</span> rename(old, <span class="hljs-built_in">new</span> <span class="hljs-keyword">string</span>) error {
	<span class="hljs-keyword">return</span> os.Rename(old, <span class="hljs-built_in">new</span>)
}

<span class="hljs-keyword">func</span> chown(name <span class="hljs-keyword">string</span>, uid <span class="hljs-keyword">int</span>, gid <span class="hljs-keyword">int</span>) error {
	<span class="hljs-keyword">return</span> os.Chown(name, uid, gid)
}

<span class="hljs-keyword">func</span> lChown(name <span class="hljs-keyword">string</span>, uid <span class="hljs-keyword">int</span>, gid <span class="hljs-keyword">int</span>) error {
	<span class="hljs-keyword">return</span> os.Lchown(name, uid, gid)
}

<span class="hljs-keyword">func</span> chmod(name <span class="hljs-keyword">string</span>, perm <span class="hljs-keyword">uint64</span>) error {
	<span class="hljs-keyword">return</span> os.Chmod(name, os.FileMode(perm))
}

<span class="hljs-keyword">func</span> stat(rt *otto.Otto, name <span class="hljs-keyword">string</span>) otto.Value {
	s, err := os.Stat(name)
	<span class="hljs-keyword">type</span> r <span class="hljs-keyword">struct</span> {
		Name       <span class="hljs-keyword">string</span>
		Size       <span class="hljs-keyword">int64</span>
		Mode       os.FileMode
		ModeString <span class="hljs-keyword">string</span>
		ModTime    time.Time
		IsDir      <span class="hljs-keyword">bool</span>
		IsRegular  <span class="hljs-keyword">bool</span>
		Perm       os.FileMode
		Error      error
	}
	<span class="hljs-keyword">if</span> err == <span class="hljs-literal">nil</span> {
		result := r{
			Error:      err,
			Name:       s.Name(),
			Size:       s.Size(),
			Mode:       s.Mode(),
			ModeString: s.Mode().String(),
			ModTime:    s.ModTime(),
			IsDir:      s.IsDir(),
			IsRegular:  s.Mode().IsRegular(),
			Perm:       s.Mode().Perm(),
		}
		<span class="hljs-keyword">return</span> mcore.Sanitize(rt, result)
	} <span class="hljs-keyword">else</span> {
		<span class="hljs-keyword">return</span> mcore.Sanitize(rt, err)
	}

}

<span class="hljs-keyword">func</span> create(path <span class="hljs-keyword">string</span>) (*os.File, error) {
	<span class="hljs-keyword">return</span> os.Create(path)
}

<span class="hljs-keyword">func</span> <span class="hljs-built_in">close</span>(f *os.File) error {
	<span class="hljs-keyword">return</span> f.Close()
}

<span class="hljs-keyword">func</span> symlink(oldname, newname <span class="hljs-keyword">string</span>) error {
	<span class="hljs-keyword">return</span> os.Symlink(oldname, newname)
}

<span class="hljs-keyword">func</span> link(oldname, newname <span class="hljs-keyword">string</span>) error {
	<span class="hljs-keyword">return</span> os.Link(oldname, newname)
}

<span class="hljs-keyword">func</span> chtimes(name <span class="hljs-keyword">string</span>) error {</pre></div>
        
      
        
        <p>get current timestamp</p>

        
          <div class='highlight'><pre>	currenttime := time.Now().Local()
	<span class="hljs-keyword">return</span> os.Chtimes(name, currenttime, currenttime)
}

<span class="hljs-keyword">func</span> init() {
	mcore.RegisterInit(<span class="hljs-keyword">func</span>(rt *otto.Otto) {
		fsObj, _ := rt.Object(<span class="hljs-string">`fs = {}`</span>)
		fsObj.Set(<span class="hljs-string">"chtimes"</span>, <span class="hljs-keyword">func</span>(call otto.FunctionCall) otto.Value {
			result := chtimes(call.Argument(<span class="hljs-number">0</span>).String())
			<span class="hljs-keyword">return</span> mcore.Sanitize(rt, result)
		})
		fsObj.Set(<span class="hljs-string">"link"</span>, <span class="hljs-keyword">func</span>(call otto.FunctionCall) otto.Value {
			result := link(call.Argument(<span class="hljs-number">0</span>).String(), call.Argument(<span class="hljs-number">1</span>).String())
			<span class="hljs-keyword">return</span> mcore.Sanitize(rt, result)
		})
		fsObj.Set(<span class="hljs-string">"symlink"</span>, <span class="hljs-keyword">func</span>(call otto.FunctionCall) otto.Value {
			result := symlink(call.Argument(<span class="hljs-number">0</span>).String(), call.Argument(<span class="hljs-number">1</span>).String())
			<span class="hljs-keyword">return</span> mcore.Sanitize(rt, result)
		})
		fsObj.Set(<span class="hljs-string">"create"</span>, <span class="hljs-keyword">func</span>(path <span class="hljs-keyword">string</span>) (otto.Value, otto.Value) {
			f := mcore.Sanitizer(rt)
			x, err := create(path)
			val, err := rt.ToValue(x)
			<span class="hljs-keyword">return</span> val, f(err)
		})
		fsObj.Set(<span class="hljs-string">"close"</span>, <span class="hljs-keyword">func</span>(f *os.File) otto.Value {
			x := mcore.Sanitizer(rt)
			<span class="hljs-keyword">return</span> x(<span class="hljs-built_in">close</span>(f))
		})
		fsObj.Set(<span class="hljs-string">"read"</span>, <span class="hljs-keyword">func</span>(fileName <span class="hljs-keyword">string</span>) otto.Value {
			f := mcore.Sanitizer(rt)
			<span class="hljs-keyword">return</span> f(read(fileName))
		})
		fsObj.Set(<span class="hljs-string">"write"</span>, <span class="hljs-keyword">func</span>(fileName, data <span class="hljs-keyword">string</span>, perm <span class="hljs-keyword">uint64</span>) otto.Value {
			f := mcore.Sanitizer(rt)
			<span class="hljs-keyword">return</span> f(write(fileName, data, perm))
		})
		fsObj.Set(<span class="hljs-string">"copy"</span>, <span class="hljs-built_in">copy</span>)
		fsObj.Set(<span class="hljs-string">"chdir"</span>, chdir)
		fsObj.Set(<span class="hljs-string">"getwd"</span>, getwd)
		fsObj.Set(<span class="hljs-string">"mkdir"</span>, mkdir)
		fsObj.Set(<span class="hljs-string">"mkdirAll"</span>, <span class="hljs-keyword">func</span>(call otto.FunctionCall) otto.Value {
			mode, err := call.Argument(<span class="hljs-number">1</span>).ToInteger()
			<span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {
				log.Fatalf(<span class="hljs-string">"Invalid argument to 'mkdirAll': %s"</span>, err)
			}
			result := mkdirAll(call.Argument(<span class="hljs-number">0</span>).String(), <span class="hljs-keyword">uint64</span>(mode))
			<span class="hljs-keyword">return</span> mcore.Sanitize(rt, result)
		})
		fsObj.Set(<span class="hljs-string">"remove"</span>, remove)
		fsObj.Set(<span class="hljs-string">"removeAll"</span>, <span class="hljs-keyword">func</span>(path <span class="hljs-keyword">string</span>) otto.Value {
			f := mcore.Sanitizer(rt)
			<span class="hljs-keyword">return</span> f(removeAll(path))
		})
		fsObj.Set(<span class="hljs-string">"rename"</span>, rename)
		fsObj.Set(<span class="hljs-string">"chown"</span>, chown)
		fsObj.Set(<span class="hljs-string">"lChown"</span>, lChown)
		fsObj.Set(<span class="hljs-string">"chmod"</span>, chmod)
		fsObj.Set(<span class="hljs-string">"dir"</span>, dir)
		fsObj.Set(<span class="hljs-string">"stat"</span>, <span class="hljs-keyword">func</span>(name <span class="hljs-keyword">string</span>) otto.Value {
			<span class="hljs-keyword">return</span> stat(rt, name)
		})
	})
}</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
