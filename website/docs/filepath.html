<!DOCTYPE html>

<html>
<head>
  <title>filepath.go</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="public/stylesheets/normalize.css" />
  <link rel="stylesheet" media="all" href="docco.css" />
</head>
<body>
  <div class="container">
    <div class="page">

      <div class="header">
        
          <h1>filepath.go</h1>
        

        
          <div class="toc">
            <h3>Table of Contents</h3>
            <ol>
              
                
                <li>
                  <a class="source" href="cli.html">
                    cli.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="become.html">
                    become.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="cache.html">
                    cache.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="copy.html">
                    copy.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="dep_graph.html">
                    dep_graph.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="elasticache.html">
                    elasticache.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="elb.html">
                    elb.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="file.html">
                    file.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="git.html">
                    git.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="iam.html">
                    iam.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="instance.html">
                    instance.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="keypairs.html">
                    keypairs.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="log.html">
                    log.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="mithras.html">
                    mithras.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="network.html">
                    network.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="object_path.html">
                    object_path.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="packager.html">
                    packager.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="rds.html">
                    rds.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="route53.html">
                    route53.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="s3.html">
                    s3.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="scp.html">
                    scp.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="secgroup.html">
                    secgroup.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="service.html">
                    service.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="shell.html">
                    shell.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="sprintf.html">
                    sprintf.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="subnet.html">
                    subnet.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="traverse.html">
                    traverse.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="vpc.html">
                    vpc.js
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="main.html">
                    main.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="build.html">
                    build.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="channels.html">
                    channels.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="core.html">
                    core.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="elasticache.html">
                    elasticache.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="elb.html">
                    elb.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="exec.html">
                    exec.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="filepath.html">
                    filepath.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="fs.html">
                    fs.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="goroutines.html">
                    goroutines.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="iam.html">
                    iam.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="instance.html">
                    instance.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="keypairs.html">
                    keypairs.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="log.html">
                    log.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="network.html">
                    network.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="os.html">
                    os.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="peek.html">
                    peek.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="rds.html">
                    rds.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="region.html">
                    region.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="remote.html">
                    remote.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="require.html">
                    require.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="route53.html">
                    route53.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="routetables.html">
                    routetables.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="s3.html">
                    s3.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="secgroup.html">
                    secgroup.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="service.html">
                    service.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="subnet.html">
                    subnet.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="tag.html">
                    tag.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="time.html">
                    time.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="user.html">
                    user.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="vpc.html">
                    vpc.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="web.html">
                    web.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="wrapper.html">
                    wrapper.go
                  </a>
                </li>
              
                
                <li>
                  <a class="source" href="script.html">
                    script.go
                  </a>
                </li>
              
            </ol>
          </div>
        
      </div>

      
        
        <p>MITHRAS: Javascript configuration management tool for AWS.
Copyright (C) 2016, Colin Steele</p>
<p> This program is free software: you can redistribute it and/or modify
 it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
                 (at your option) any later version.</p>
<p>   This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
             GNU General Public License for more details.</p>
<p>  You should have received a copy of the GNU General Public License
along with this program.  If not, see <a href="http://www.gnu.org/licenses/">http://www.gnu.org/licenses/</a>.</p>

        
      
        
        <h1 id="core-functions-filepath">CORE FUNCTIONS: FILEPATH</h1>

        
          <div class='highlight'><pre>
<span class="hljs-keyword">package</span> filepath</pre></div>
        
      
        
        <p>This package exports entry points into the JS environment:</p>
<blockquote>
<ul>
<li><a href="#dir">filepath.dir</a></li>
<li><a href="#base">filepath.base</a></li>
<li><a href="#ext">filepath.ext</a></li>
<li><a href="#glob">filepath.glob</a></li>
<li><a href="#match">filepath.match</a></li>
<li><a href="#split">filepath.split</a></li>
<li><a href="#splitlist">filepath.splitList</a></li>
<li><a href="#rel">filepath.rel</a></li>
<li><a href="#clean">filepath.clean</a></li>
<li><a href="#abs">filepath.abs</a></li>
<li><a href="#join">filepath.join</a></li>
<li><a href="#walk">filepath.walk</a></li>
</ul>
</blockquote>
<p>This API allows the caller to work with filesystem paths.</p>
<h2 id="filepath-dir">FILEPATH.DIR</h2>
<p><a name="dir"></a>
<code>filepath.dir(path);</code></p>
<p>Dir returns all but the last element of path, typically the path’s
directory. After dropping the final element, the path is Cleaned
and trailing slashes are removed. If the path is empty, Dir returns
“.”. If the path consists entirely of separators, Dir returns a
single separator. The returned path does not end in a separator
unless it is the root directory.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> dir = filepath.dir(<span class="hljs-string">"/tmp/foo"</span>);
</code></pre><h2 id="filepath-base">FILEPATH.BASE</h2>
<p><a name="base"></a>
<code>filepath.base(path);</code></p>
<p>Base returns the last element of path. Trailing path separators are
removed before extracting the last element. If the path is empty,
Base returns “.”. If the path consists entirely of separators, Base
returns a single separator.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> base = filepath.base(<span class="hljs-string">"/tmp/foo"</span>);
</code></pre><h2 id="filepath-ext">FILEPATH.EXT</h2>
<p><a name="ext"></a>
<code>filepath.ext(path);</code></p>
<p>Ext returns the file name extension used by path. The extension is
the suffix beginning at the final dot in the final element of path;
it is empty if there is no dot.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> ext = filepath.ext(<span class="hljs-string">"/tmp/foo.jpg"</span>);
</code></pre><h2 id="filepath-glob">FILEPATH.GLOB</h2>
<p><a name="glob"></a>
<code>filepath.glob(pattern);</code></p>
<p>Glob returns the names of all files matching pattern or nil if
there is no matching file. The syntax of patterns is the same as in
Match. The pattern may describe hierarchical names such as
/usr/*/bin/ed (assuming the Separator is ‘/‘).</p>
<p>Glob ignores file system errors such as I/O errors reading
directories. The only possible returned error is ErrBadPattern,
when pattern is malformed.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = filepath.glob(<span class="hljs-string">"/tmp/*.jpg"</span>);
 <span class="hljs-keyword">var</span> matches = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> error = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="filepath-match">FILEPATH.MATCH</h2>
<p><a name="match"></a>
<code>filepath.match(pattern, name);</code></p>
<p>Match reports whether name matches the shell file name pattern.
See <a href="https://golang.org/pkg/path/filepath/#Dir">here</a> for syntax.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = filepath.match(<span class="hljs-string">"/tmp/*.jpg"</span>, <span class="hljs-string">"/var/other"</span>);
 <span class="hljs-keyword">var</span> matched = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> error = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="filepath-split">FILEPATH.split</h2>
<p><a name="split"></a>
<code>filepath.split(path);</code></p>
<p>Split splits path immediately following the final Separator,
separating it into a directory and file name component. If there is
no Separator in path, Split returns an empty dir and file set to
path. The returned values have the property that path = dir+file.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = filepath.split(<span class="hljs-string">"/tmp/foo.jpg"</span>);
 <span class="hljs-keyword">var</span> dir = results[<span class="hljs-number">0</span>];
 <span class="hljs-keyword">var</span> file = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="filepath-splitlist">FILEPATH.splitList</h2>
<p><a name="splitlist"></a>
<code>filepath.splitList(path);</code></p>
<p>SplitList splits a list of paths joined by the OS-specific
ListSeparator, usually found in PATH or GOPATH environment
variables. Unlike strings.Split, SplitList returns an empty slice
when passed an empty string. SplitList does not replace slash
characters in the returned paths.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> parts = filepath.splitList(<span class="hljs-string">"/tmp/bar/foo.jpg"</span>);
</code></pre><h2 id="filepath-rel">FILEPATH.rel</h2>
<p><a name="rel"></a>
<code>filepath.rel(basePath, targetPath);</code></p>
<p>Rel returns a relative path that is lexically equivalent to
targpath when joined to basepath with an intervening
separator. That is, Join(basepath, Rel(basepath, targpath)) is
equivalent to targpath itself. On success, the returned path will
always be relative to basepath, even if basepath and targpath share
no elements. An error is returned if targpath can’t be made
relative to basepath or if knowing the current working directory
would be necessary to compute it.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = filepath.rel(<span class="hljs-string">"/a"</span>, <span class="hljs-string">"/a/b/c"</span>);
 <span class="hljs-keyword">var</span> path = results[<span class="hljs-number">0</span>];  <span class="hljs-comment">// =&gt; "b/c"</span>
 <span class="hljs-keyword">var</span> error = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="filepath-clean">FILEPATH.clean</h2>
<p><a name="clean"></a>
<code>filepath.clean(path);</code></p>
<p>Clean returns the shortest path name equivalent to path by purely lexical processing.
See <a href="https://golang.org/pkg/path/filepath/#Dir">here</a> for rules.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> squeaky = filepath.clean(<span class="hljs-string">"/a//b"</span>); <span class="hljs-comment">// =&gt; "/a/b"</span>
</code></pre><h2 id="filepath-abs">FILEPATH.abs</h2>
<p><a name="abs"></a>
<code>filepath.abs(path);</code></p>
<p>Abs returns an absolute representation of path. If the path is not
absolute it will be joined with the current working directory to
turn it into an absolute path. The absolute path name for a given
file is not guaranteed to be unique.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> results = filepath.abs(<span class="hljs-string">"/a/../b"</span>);
 <span class="hljs-keyword">var</span> path = results[<span class="hljs-number">0</span>]; <span class="hljs-comment">// =&gt; "/b"</span>
 <span class="hljs-keyword">var</span> err = results[<span class="hljs-number">1</span>];
</code></pre><h2 id="filepath-join">FILEPATH.join</h2>
<p><a name="join"></a>
<code>filepath.join();</code></p>
<p>Join joins any number of path elements into a single path, adding a
Separator if necessary. The result is Cleaned.</p>
<p>Example:</p>
<pre><code>
 <span class="hljs-keyword">var</span> joined = filepath.join(<span class="hljs-string">"/a"</span>, <span class="hljs-string">"/b"</span>);
</code></pre><h2 id="filepath-walk">FILEPATH.walk</h2>
<p><a name="walk"></a>
<code>filepath.walk(path, walker);</code></p>
<p>Walk walks the file tree rooted at root, calling <code>walker</code> for each
file or directory in the tree, including root. All errors that
arise visiting files and directories are filtered by <code>walker</code>. The
files are walked in lexical order, which makes the output
deterministic but means that for very large directories Walk can be
inefficient. Walk does not follow symbolic links.</p>
<p>Example:</p>
<pre><code>
 filepath.walk(<span class="hljs-string">"/var"</span>, function(path,info,err) { console.log(path); });
</code></pre>
        
          <div class='highlight'><pre><span class="hljs-keyword">import</span> (
	<span class="hljs-string">"errors"</span>
	<span class="hljs-string">"log"</span>
	<span class="hljs-string">"os"</span>
	<span class="hljs-string">"path/filepath"</span>
	<span class="hljs-string">"time"</span>

	<span class="hljs-string">"github.com/robertkrimen/otto"</span>

	<span class="hljs-string">"github.com/cvillecsteele/mithras/modules/core"</span>
)

<span class="hljs-keyword">var</span> Version = <span class="hljs-string">"1.0.0"</span>
<span class="hljs-keyword">var</span> ModuleName = <span class="hljs-string">"filepath"</span>

<span class="hljs-keyword">func</span> dir(path <span class="hljs-keyword">string</span>) <span class="hljs-keyword">string</span> {
	<span class="hljs-keyword">return</span> filepath.Dir(path)
}

<span class="hljs-keyword">func</span> base(path <span class="hljs-keyword">string</span>) <span class="hljs-keyword">string</span> {
	<span class="hljs-keyword">return</span> filepath.Base(path)
}

<span class="hljs-keyword">func</span> ext(path <span class="hljs-keyword">string</span>) <span class="hljs-keyword">string</span> {
	<span class="hljs-keyword">return</span> filepath.Ext(path)
}

<span class="hljs-keyword">func</span> glob(pattern <span class="hljs-keyword">string</span>) ([]<span class="hljs-keyword">string</span>, error) {
	<span class="hljs-keyword">return</span> filepath.Glob(pattern)
}

<span class="hljs-keyword">func</span> match(pattern, name <span class="hljs-keyword">string</span>) (<span class="hljs-keyword">bool</span>, error) {
	<span class="hljs-keyword">return</span> filepath.Match(pattern, name)
}

<span class="hljs-keyword">func</span> split(path <span class="hljs-keyword">string</span>) (<span class="hljs-keyword">string</span>, <span class="hljs-keyword">string</span>) {
	<span class="hljs-keyword">return</span> filepath.Split(path)
}

<span class="hljs-keyword">func</span> splitList(path <span class="hljs-keyword">string</span>) []<span class="hljs-keyword">string</span> {
	<span class="hljs-keyword">return</span> filepath.SplitList(path)
}

<span class="hljs-keyword">func</span> rel(basepath, targpath <span class="hljs-keyword">string</span>) (<span class="hljs-keyword">string</span>, error) {
	<span class="hljs-keyword">return</span> filepath.Rel(basepath, targpath)
}

<span class="hljs-keyword">func</span> clean(path <span class="hljs-keyword">string</span>) <span class="hljs-keyword">string</span> {
	<span class="hljs-keyword">return</span> filepath.Clean(path)
}

<span class="hljs-keyword">func</span> abs(path <span class="hljs-keyword">string</span>) (<span class="hljs-keyword">string</span>, error) {
	<span class="hljs-keyword">return</span> filepath.Abs(path)
}

<span class="hljs-keyword">func</span> join(elem ...<span class="hljs-keyword">string</span>) <span class="hljs-keyword">string</span> {
	<span class="hljs-keyword">return</span> filepath.Join(elem...)
}

<span class="hljs-keyword">func</span> init() {
	core.RegisterInit(<span class="hljs-keyword">func</span>(rt *otto.Otto) {
		obj, _ := rt.Object(<span class="hljs-string">`filepath = {}`</span>)
		obj.Set(<span class="hljs-string">"walk"</span>, <span class="hljs-keyword">func</span>(call otto.FunctionCall) otto.Value {
			cb := call.Argument(<span class="hljs-number">1</span>)
			f := core.Sanitizer(rt)
			filepath.Walk(call.Argument(<span class="hljs-number">0</span>).String(),
				<span class="hljs-keyword">func</span>(path <span class="hljs-keyword">string</span>, info os.FileInfo, err error) error {
					<span class="hljs-keyword">type</span> r <span class="hljs-keyword">struct</span> {
						Name       <span class="hljs-keyword">string</span>
						Size       <span class="hljs-keyword">int64</span>
						Mode       os.FileMode
						ModeString <span class="hljs-keyword">string</span>
						ModTime    time.Time
						IsDir      <span class="hljs-keyword">bool</span>
						IsRegular  <span class="hljs-keyword">bool</span>
						Perm       os.FileMode
						Error      error
					}
					i := r{
						Name:       info.Name(),
						Size:       info.Size(),
						Mode:       info.Mode(),
						ModeString: info.Mode().String(),
						ModTime:    info.ModTime(),
						IsDir:      info.IsDir(),
						IsRegular:  info.Mode().IsRegular(),
						Perm:       info.Mode().Perm(),
					}
					result, oops := cb.Call(otto.Value{}, path, f(i), f(err))
					<span class="hljs-keyword">if</span> oops != <span class="hljs-literal">nil</span> {
						log.Fatalf(<span class="hljs-string">"Error in walk callback: %s"</span>, oops)
					}
					<span class="hljs-keyword">if</span> result.IsUndefined() {
						<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
					} <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> result.String() == <span class="hljs-string">"skip"</span> {
						<span class="hljs-keyword">return</span> filepath.SkipDir
					} <span class="hljs-keyword">else</span> {
						<span class="hljs-keyword">return</span> errors.New(result.String())
					}
					<span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>
				})
			<span class="hljs-keyword">return</span> otto.Value{}
		})
		obj.Set(<span class="hljs-string">"abs"</span>, abs)
		obj.Set(<span class="hljs-string">"clean"</span>, clean)
		obj.Set(<span class="hljs-string">"rel"</span>, rel)
		obj.Set(<span class="hljs-string">"splitList"</span>, splitList)
		obj.Set(<span class="hljs-string">"split"</span>, split)
		obj.Set(<span class="hljs-string">"match"</span>, match)
		obj.Set(<span class="hljs-string">"glob"</span>, glob)
		obj.Set(<span class="hljs-string">"ext"</span>, ext)
		obj.Set(<span class="hljs-string">"dir"</span>, dir)
		obj.Set(<span class="hljs-string">"base"</span>, base)
		obj.Set(<span class="hljs-string">"join"</span>, join)
	})
}</pre></div>
        
      
      <div class="fleur">h</div>
    </div>
  </div>
</body>
</html>
